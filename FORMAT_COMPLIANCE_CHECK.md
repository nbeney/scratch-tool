# Scratch File Format Compliance Check

Comparing `models/project.py` with the official Scratch File Format specification from:
https://en.scratch-wiki.info/wiki/Scratch_File_Format

## âœ… COMPLIANT - Projects

According to spec:
- `targets`: Array of targets âœ…
- `monitors`: Array of monitors âœ…
- `extensions`: Array of extension identifiers âœ…
- `meta`: Metadata object âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âš ï¸ PARTIAL - Targets

According to spec, targets should have:

### Required Properties:
- `isStage`: bool âœ…
- `name`: string âœ…
- `variables`: Dict[id, [name, value, cloud?]] âš ï¸ **ISSUE**
- `lists`: Dict[id, [name, array]] âœ…
- `broadcasts`: Dict[id, name] âœ…
- `blocks`: Dict[id, Block] âœ…
- `comments`: Dict[id, Comment] âœ…
- `currentCostume`: int âœ…
- `costumes`: Array of Costume âœ…
- `sounds`: Array of Sound âœ…
- `layerOrder`: int âœ…
- `volume`: number âœ…

### Stage-Specific:
- `tempo`: number âœ…
- `videoState`: "on"|"off"|"on-flipped" âœ…
- `videoTransparency`: number âœ…
- `textToSpeechLanguage`: string|null âœ…

### Sprite-Specific:
- `visible`: bool âœ…
- `x`: number âœ…
- `y`: number âœ…
- `size`: number âœ…
- `direction`: number âœ…
- `draggable`: bool âœ…
- `rotationStyle`: "all around"|"left-right"|"don't rotate" âœ…

**Issues Found**:
1. âš ï¸ **Variables format**: The spec says variables are `[name, value]` or `[name, value, true]` for cloud variables. Our model uses `List[Union[str, int, float, bool]]` which is correct, but we should document that the 3rd element (if present) indicates cloud variable status.

**Status**: âœ… **MOSTLY COMPLIANT** (documentation improvement needed)

---

## âœ… COMPLIANT - Blocks

According to spec, blocks have:
- `opcode`: string âœ…
- `next`: string|null âœ…
- `parent`: string|null âœ…
- `inputs`: Dict[name, array] âœ…
- `fields`: Dict[name, array] âœ…
- `shadow`: bool âœ…
- `topLevel`: bool âœ…
- `x`: number (if topLevel) âœ…
- `y`: number (if topLevel) âœ…
- `mutation`: object (optional) âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âœ… COMPLIANT - Comments

According to spec, comments have:
- `blockId`: string|null âœ…
- `x`: number âœ…
- `y`: number âœ…
- `width`: number âœ…
- `height`: number âœ…
- `minimized`: bool âœ…
- `text`: string âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âœ… COMPLIANT - Costumes

According to spec, costumes have:
- `assetId`: string (MD5 hash) âœ…
- `name`: string âœ…
- `md5ext`: string (hash + extension) âœ…
- `dataFormat`: string ("svg", "png", "jpg") âœ…
- `bitmapResolution`: number (optional) âœ…
- `rotationCenterX`: number âœ…
- `rotationCenterY`: number âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âœ… COMPLIANT - Sounds

According to spec, sounds have:
- `assetId`: string âœ…
- `name`: string âœ…
- `md5ext`: string âœ…
- `dataFormat`: string ("wav", "mp3") âœ…
- `rate`: number (sampling rate) âœ…
- `sampleCount`: number âœ…

**Additional in model**:
- `format`: string (empty or format info) - This is present in actual project files âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âœ… COMPLIANT - Monitors

According to spec, monitors have:
- `id`: string âœ…
- `mode`: "default"|"large"|"slider"|"list" âœ…
- `opcode`: string âœ…
- `params`: object âœ…
- `spriteName`: string|null âœ…
- `value`: any âœ…
- `width`: number âœ…
- `height`: number âœ…
- `x`: number âœ…
- `y`: number âœ…
- `visible`: bool âœ…
- `sliderMin`: number (if not list) âœ…
- `sliderMax`: number (if not list) âœ…
- `isDiscrete`: bool (if not list) âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âœ… COMPLIANT - Metadata (Meta)

According to spec, meta has:
- `semver`: string (always "3.0.0") âœ…
- `vm`: string (VM version) âœ…
- `agent`: string (user agent) âœ…

**Status**: âœ… **FULLY COMPLIANT**

---

## âŒ NOT USED - Extension Model

Our model has an `Extension` class with:
- `extensionId`: string
- `extensionName`: string (optional)

**Issue**: According to the spec, extensions are stored as a simple array of strings (extension IDs), not as objects. Our `Extension` model class is not used in the `ScratchProject` model.

**Current implementation**: `extensions: List[str]` âœ… **CORRECT**

**Status**: âœ… **Model is correct** (Extension class is unused and can be removed)

---

## ğŸ” Additional Validation Notes

### Block Inputs
The spec describes inputs as arrays with:
1. First element: 1 (shadow), 2 (no shadow), or 3 (obscured shadow)
2. Second element: ID or array representing the input
3. Third element (if obscured): shadow ID or array

Our model uses `Dict[str, Any]` which is flexible enough to handle this structure âœ…

### Block Fields
The spec describes fields as arrays with:
1. First element: field value
2. Second element (for variables/broadcasts): ID

Our model uses `Dict[str, List[Any]]` which correctly represents this âœ…

### Variables Format
Variables are stored as: `[name, value]` or `[name, value, true]` where the third element indicates cloud variable.
Our model type `List[Union[str, int, float, bool]]` handles this correctly âœ…

---

## Summary

### âœ… Fully Compliant Components:
- Projects structure
- Blocks
- Comments
- Costumes
- Sounds
- Monitors
- Metadata

### âš ï¸ Minor Issues:
- ~~**Extension class**: Unused class definition that doesn't match spec (extensions are strings, not objects)~~ **FIXED** âœ…
  - Action: ~~Can be removed or marked as deprecated~~ **REMOVED**
  
### ğŸ“ Documentation Improvements:
- ~~Document that variables can have 3rd element for cloud variables~~ **ADDED** âœ…
- ~~Document block input/field array structure~~ **ADDED** âœ…

### Overall Compliance: âœ… **100% COMPLIANT**

The models now fully and correctly represent the Scratch project.json format according to the official specification. All components have been verified and documented.

## Changes Made:
1. âœ… Removed unused `BlockInput` class
2. âœ… Removed unused `Extension` class  
3. âœ… Added documentation for cloud variables in Target model
4. âœ… Added comprehensive documentation for Block inputs/fields format
5. âœ… Added detailed documentation for Meta properties
6. âœ… Added extension IDs documentation in ScratchProject docstring
7. âœ… All 47 tests passing
